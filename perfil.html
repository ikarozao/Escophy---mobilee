<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perfil</title>
    <link rel="stylesheet" href="perfil/perfil.css">
    <link rel="icon" type="image/png" href="img/a.png">
</head>

<body>
    <nav>
       <a href="home.html"><div class="bar_n">Escorphy</div></a> 
        <div class="nav-right">
            <div class="search-box">
                <input type="text" placeholder="Pesquisar..." />
            </div>
        </div>
    </nav>

    <div class="main-content-perfil">
        <div class="column left-column">
            <article class="usuario">
                <div>
                    <h2 id="nomeUsuario">Ol√°, usuario</h2>
                </div>

                <div class="foto_perfil" id="fotoPerfil">
                 <img id="imgPerfil" src="img/perfil-removebg-preview.png" alt="Imagem do perfil">
                </div>

                
                <input type="file" id="inputPerfil" accept="image/*" hidden>

                <!-- √Årea para futuros posts -->
                <div class="foto_upload">
                    <input type="file" id="upload" hidden multiple>
                    <label for="upload" class="upload-btn">Adicionar Foto</label>
                    <div class="preview" id="preview"></div>
                </div>

                <article class="info_usua">
                    <span>Treinos</span>
                    <span>Publica√ß√µes</span>
                    <span>Seguidores</span>
                    <span>Seguindo</span>
                </article>

                <article class="info_usua2">
                    <span>3</span>
                    <span>2</span>
                    <span>50</span>
                    <span>20</span>
                </article>
            </article>

            <article class="treinos">
                <div>
                    <h2>Treinos Realizados</h2>
                </div>
                <div>
                    <ul>
                        <a href="treino1.html">
                            <li><span class="atividade">Ciclismo</span> <span class="data">23/03/2025</span></li>
                        </a>
                        <li><span class="atividade">Corrida</span> <span class="data">20/03/2025</span></li>
                        <li><span class="atividade">Caminhada</span> <span class="data">17/03/2025</span></li>
                    </ul>
                </div>
            </article>
        </div>

        <div class="column right-column">
            <article class="publi_usua">
                <div>
                    <h2>Suas Publica√ß√µes</h2>
                </div>
                <div class="post">
                    <img src="img/Tudo-o-que-voce-precisa-saber-sobre-ciclismo.jpg" alt="">
                    <div class="detalhes">
                        <span>üèÖ Esporte: Ciclismo</span>
                        <span>üìè Dist√¢ncia: 25 km</span>
                        <span>‚õ∞Ô∏è Eleva√ß√£o: 500 m</span>
                        <span>‚è±Ô∏è Tempo: 1h 30min</span>
                        <span>üî• Calorias: 800 kcal</span>
                    </div>
                </div>
                <div class="post">
                    <img src="img/images.jpeg" alt="">
                    <div class="detalhes">
                        <span>üèÉ‚Äç‚ôÇÔ∏è Esporte: Corrida</span>
                        <span>üìè Dist√¢ncia: 10 km</span>
                        <span>‚è±Ô∏è Tempo: 50 min</span>
                        <span>üî• Calorias: 600 kcal</span>
                    </div>
                </div>
            </article>

            <article class="sugeridos">
                <div>
                    <h2>Contas Sugeridas</h2>
                </div>
                <article class="contas_sugeridas">
                    <div class="cs2">
                        <div class="foto_perfil">
                            <img src="img/perfil-removebg-preview.png" alt="Imagem do treino">
                        </div>
                        <div class="foto_upload">
                            <label for="upload" class="upload-btn-sugerido">@valeria</label>
                        </div>
                    </div>
                    <div class="cs2">
                        <div class="foto_perfil">
                            <img src="img/perfil-removebg-preview.png" alt="Imagem do treino">
                        </div>
                        <div class="foto_upload">
                            <label for="upload" class="upload-btn-sugerido">@almeida</label>
                        </div>
                    </div>
                    <div class="cs2">
                        <div class="foto_perfil">
                            <img src="img/perfil-removebg-preview.png" alt="Imagem do treino">
                        </div>
                        <div class="foto_upload">
                            <label for="upload" class="upload-btn-sugerido">@spatona</label>
                        </div>
                    </div>
                    <div class="cs2">
                        <div class="foto_perfil">
                            <img src="img/perfil-removebg-preview.png" alt="Imagem do treino">
                        </div>
                        <div class="foto_upload">
                            <label for="upload" class="upload-btn-sugerido">@itsme</label>
                        </div>
                    </div>
                </article>
            </article>
        </div>
    </div>

    <div class="floating-buttons-container">
        <a href="home.html">
            <div class="botaoperfil-container">
                <button class="botaoperfil" id="botaoperfil">
                    <img src="img/home.png" alt="√çcone Perfil">
                </button>
            </div>
        </a>
        <a href="treino1.html">
            <div class="botaomais-container">
                <button class="botaomais" id="botaoMais">+</button>
            </div>
        </a>
    </div>
    <script src="https://unpkg.com/@supabase/supabase-js"></script>
<script>
  // ================================
  // Configura√ß√£o do Supabase
  // ================================
  const supabaseUrl = 'https://SEU-PROJETO.supabase.co';
  const supabaseKey = 'SUA-CHAVE-ANON';
  const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);

  // ================================
  // Seletores
  // ================================
  const inputPerfil = document.getElementById("inputPerfil");
  const imgPerfil = document.getElementById("imgPerfil");
  const fotoPerfil = document.getElementById("fotoPerfil");
  const uploadPost = document.getElementById('upload');
  const preview = document.getElementById('preview');

  const usuario = localStorage.getItem("usuarioLogado");
  const usuarioEmail = localStorage.getItem("usuarioEmail");

  // ================================
  // Mostrar nome do usu√°rio
  // ================================
  if (usuario && usuario.trim() !== "") {
    document.getElementById("nomeUsuario").textContent = `Ol√°, ${usuario.trim()}`;
  }

  // ================================
  // Clique na foto abre input
  // ================================
  fotoPerfil.addEventListener("click", () => inputPerfil.click());

  // ================================
  // Fun√ß√£o para carregar foto do banco
  // ================================
  async function carregarFotoPerfil() {
    if (!usuarioEmail) return;

    try {
      const { data, error } = await supabaseClient
        .from("usuarios")
        .select("foto_perfil")
        .eq("email", usuarioEmail)
        .single();

      if (error) throw error;

      if (data?.foto_perfil) imgPerfil.src = data.foto_perfil;
    } catch (err) {
      console.error("Erro ao buscar foto de perfil:", err.message);
    }
  }

  // ================================
  // Upload de nova foto
  // ================================
  inputPerfil.addEventListener("change", async (event) => {
    const file = event.target.files[0];
    if (!file || !usuarioEmail) return console.error("Arquivo ou email n√£o encontrados.");

    const fileName = `${usuarioEmail}_${Date.now()}_${file.name}`;

    try {
      // Upload para o bucket "perfil"
      const { error: uploadError } = await supabaseClient
        .storage
        .from("perfil")
        .upload(fileName, file, { upsert: true });

      if (uploadError) throw uploadError;

      // Pega URL p√∫blica
      const { data: publicUrlData, error: urlError } = supabaseClient
        .storage
        .from("perfil")
        .getPublicUrl(fileName);

      if (urlError) throw urlError;

      const publicUrl = publicUrlData.publicUrl;

      // Atualiza no banco
      const { error: updateError } = await supabaseClient
        .from("usuarios")
        .update({ foto_perfil: publicUrl })
        .eq("email", usuarioEmail);

      if (updateError) throw updateError;

      // Atualiza a imagem na tela
      imgPerfil.src = publicUrl;
      console.log("‚úÖ Foto de perfil atualizada com sucesso!");
    } catch (err) {
      console.error("Erro no upload de perfil:", err.message);
    }
  });

  // ================================
  // Executa ao abrir a p√°gina
  // ================================
  carregarFotoPerfil();

  // ================================
  // Preview das imagens de post
  // ================================
  uploadPost.addEventListener('change', function (event) {
    preview.innerHTML = '';
    const files = Array.from(event.target.files);

    files.forEach(file => {
      const reader = new FileReader();
      reader.onload = (e) => {
        const img = document.createElement('img');
        img.src = e.target.result;
        img.style.cssText = `
          width: 100px;
          height: 100px;
          border-radius: 10px;
          margin: 5px;
          object-fit: cover;
        `;
        preview.appendChild(img);
      };
      reader.readAsDataURL(file);
    });
  });
</script>


</body>

</html>
