<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perfil</title>
    <link rel="stylesheet" href="perfil/perfil.css">
    <link rel="icon" type="image/png" href="img/a.png">
</head>

<body>
    <nav>
        <a href="home.html"><div class="bar_n">Escorphy</div></a>
        <div class="nav-right">
            <div class="search-box">
                <input type="text" placeholder="Pesquisar..." />
            </div>
        </div>
    </nav>

    <div class="main-content-perfil">
        <div class="column left-column">
            <article class="usuario">
                <div>
                    <h2 id="nomeUsuario">Ol√°, usuario</h2>
                </div>

                <div class="foto_perfil" id="fotoPerfil">
                    <img id="imgPerfil" src="img/perfil-removebg-preview.png" alt="Imagem do perfil">
                </div>

                <input type="file" id="inputPerfil" accept="image/*" hidden>

                <article class="info_usua">
                    <span>Treinos</span>
                    <span>Publica√ß√µes</span>
                    <span>Seguidores</span>
                    <span>Seguindo</span>
                </article>

                <article class="info_usua2">
                    <span id="contTreinos">0</span>
                    <span id="contPublicacoes">0</span>
                    <span>50</span>
                    <span>20</span>
                </article>
            </article>

            <!-- Treinos Realizados -->
            <article class="treinos">
                <div>
                    <h2>Treinos Realizados</h2>
                </div>
                <div>
                    <ul id="listaTreinos"></ul>
                </div>
            </article>
        </div>

        <div class="column right-column">
            <!-- Publica√ß√µes do usu√°rio -->
            <article class="publi_usua">
                <div>
                    <h2>Suas Publica√ß√µes</h2>
                </div>
                <div id="listaPublicacoes"></div>
            </article>

            <!-- Contas Sugeridas -->
            <article class="sugeridos">
                <div>
                    <h2>Contas Sugeridas</h2>
                </div>
                <article class="contas_sugeridas">
                    <div class="cs2">
                        <div class="foto_perfil">
                            <img src="img/perfil-removebg-preview.png" alt="Imagem do treino">
                        </div>
                        <div class="foto_upload">
                            <label for="upload" class="upload-btn-sugerido">@valeria</label>
                        </div>
                    </div>
                    <div class="cs2">
                        <div class="foto_perfil">
                            <img src="img/perfil-removebg-preview.png" alt="Imagem do treino">
                        </div>
                        <div class="foto_upload">
                            <label for="upload" class="upload-btn-sugerido">@almeida</label>
                        </div>
                    </div>
                    <div class="cs2">
                        <div class="foto_perfil">
                            <img src="img/perfil-removebg-preview.png" alt="Imagem do treino">
                        </div>
                        <div class="foto_upload">
                            <label for="upload" class="upload-btn-sugerido">@spatona</label>
                        </div>
                    </div>
                    <div class="cs2">
                        <div class="foto_perfil">
                            <img src="img/perfil-removebg-preview.png" alt="Imagem do treino">
                        </div>
                        <div class="foto_upload">
                            <label for="upload" class="upload-btn-sugerido">@itsme</label>
                        </div>
                    </div>
                </article>
            </article>
        </div>
    </div>

    <div class="floating-buttons-container">
        <a href="home.html">
            <div class="botaoperfil-container">
                <button class="botaoperfil" id="botaoperfil">
                    <img src="img/home.png" alt="√çcone Perfil">
                </button>
            </div>
        </a>
        <a href="treino1.html">
            <div class="botaomais-container">
                <button class="botaomais" id="botaoMais">+</button>
            </div>
        </a>
    </div>

    <footer class="footer">
    <div class="footer-container">
        <div class="footer-logo">
            <h1>ESCORPHY</h1>
            <p>¬© 2025 Escorphy</p>
        </div>

        <div class="footer-column">
            <h3>Sobre</h3>
            <ul>
                <li><a href="sobrenos.html">Nossa Hist√≥ria</a></li>
                <li><a href="sobrenos.html">Miss√£o</a></li>
                <li><a href="sobrenos.html">Equipe</a></li>
                <li><a href="#">Privacidade</a></li>
            </ul>
        </div>

        <div class="footer-column">
            <h3>Explorar</h3>
            <ul>
                <li><a href="#">Funcionalidades</a></li>
                <li><a href="#">Planos</a></li>
                <li><a href="#">Blog</a></li>
            </ul>
        </div>

        <div class="footer-column">
            <h3>Redes</h3>
            <ul class="social-icons">
                <li><a href="https://www.instagram.com/escorphybr"><i class="fab fa-instagram"></i> Instagram</a></li>
                <li><a href="https://www.youtube.com/escorphy"><i class="fab fa-youtube"></i> YouTube</a></li>
            </ul>
        </div>

        <div class="footer-column">
            <h3>Ajuda</h3>
            <ul>
                <li><a href="#">Suporte</a></li>
                <li><a href="https://mail.google.com/mail/u/0/#inbox?compose=CllgCJNxPFlgRKMfNbXtjRlNsMrbsQVVFLbfkqPmwWGZnCVDDPjSWwvcTngxGFMGsRTMztTSRxV">Fale Conosco</a></li>
                <li><a href="#">Central de Ajuda</a></li>
            </ul>
        </div>
    </div>
</footer>
</body>

    <script src="https://unpkg.com/@supabase/supabase-js"></script>
<script>
  // ===============================
  // Vari√°veis do usu√°rio
  // ===============================
  const usuario = localStorage.getItem("usuarioLogado");
  const usuarioEmail = localStorage.getItem("usuarioEmail");

  console.log(usuario, usuarioEmail); // Debug: veja se os dados existem

  // ===============================
  // Supabase
  // ===============================
  const supabaseUrl = 'https://szachxclixfketavlkyv.supabase.co';
  const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InN6YWNoeGNsaXhma2V0YXZsa3l2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQzMDYwNTIsImV4cCI6MjA2OTg4MjA1Mn0.mL71dNsCRvhVluuiz6WUB9fBeLZoy6QyMue6nc3B_-g';
  const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);

  const inputPerfil = document.getElementById("inputPerfil");
  const imgPerfil = document.getElementById("imgPerfil");
  const fotoPerfil = document.getElementById("fotoPerfil");

  // ===============================
  // Nome do usu√°rio
  // ===============================
  if (usuario && usuario.trim() !== "") {
    document.getElementById("nomeUsuario").textContent = `Ol√°, ${usuario.trim()}`;
  }

  // ===============================
  // Clique na foto abre input
  // ===============================
  fotoPerfil.addEventListener("click", () => inputPerfil.click());

  // ===============================
  // Carregar foto do perfil
  // ===============================
  async function carregarFotoPerfil() {
    if (!usuarioEmail) return;

    const { data, error } = await supabaseClient
      .from("usuarios")
      .select("foto_perfil")
      .eq("email", usuarioEmail)
      .single();

    if (error) {
      console.error("Erro ao buscar foto de perfil:", error.message);
      return;
    }

    if (data?.foto_perfil) imgPerfil.src = data.foto_perfil;
  }

  // ===============================
  // Upload de nova foto
  // ===============================
  inputPerfil.addEventListener("change", async (event) => {
    const file = event.target.files[0];
    if (!file || !usuarioEmail) return;

    const fileName = `${usuarioEmail}_${Date.now()}_${file.name}`;
    try {
      await supabaseClient.storage.from("perfil").upload(fileName, file, { upsert: true });

      const { data: publicUrlData } = supabaseClient.storage.from("perfil").getPublicUrl(fileName);
      const publicUrl = publicUrlData.publicUrl;

      await supabaseClient.from("usuarios").update({ foto_perfil: publicUrl }).eq("email", usuarioEmail);
      imgPerfil.src = publicUrl;

    } catch (err) {
      console.error("Erro no upload de perfil:", err.message);
    }
  });

  // ===============================
  // Carregar treinos e publica√ß√µes
  // ===============================
  async function carregarTreinosEPub() {
    if (!usuarioEmail) return;

    // Treinos realizados
    const { data: treinos, error: treinosError } = await supabaseClient
      .from("atividades")
      .select("*")
      .eq("email_usuario", usuarioEmail)
      .order("data", { ascending: false });

    if (treinosError) {
      console.error("Erro ao buscar treinos:", treinosError.message);
      return;
    }

    const listaTreinos = document.getElementById("listaTreinos");
    listaTreinos.innerHTML = "";

    treinos.forEach(t => {
      const li = document.createElement("li");
      const link = document.createElement("a");
      link.href = `treino1.html?id=${t.id}`;
      link.innerHTML = `<span class="atividade">${t.titulo}</span> <span class="data">${new Date(t.data).toLocaleDateString()}</span>`;
      li.appendChild(link);
      listaTreinos.appendChild(li);
    });
    document.getElementById("contTreinos").textContent = treinos.length;

    // Publica√ß√µes p√∫blicas
    const { data: publicacoes, error: pubsError } = await supabaseClient
      .from("atividades")
      .select("*")
      .eq("email_usuario", usuarioEmail)
      .eq("visibilidade", "P√∫blico")
      .order("data", { ascending: false });

    if (pubsError) {
      console.error("Erro ao buscar publica√ß√µes:", pubsError.message);
      return;
    }

    const listaPublicacoes = document.getElementById("listaPublicacoes");
    listaPublicacoes.innerHTML = "";

    publicacoes.forEach(p => {
      const div = document.createElement("div");
      div.className = "post";
      div.innerHTML = `
        <a href="treino1.html?id=${p.id}" class="post-link">
          <div class="detalhes">
            <span>üèÖ Esporte: ${p.titulo}</span>
            <span>üìè Dist√¢ncia: ${p.acessorios || "-"}</span>
            <span>‚è±Ô∏è Tempo: 1h 0min</span>
            <span>üî• Calorias: 500 kcal</span>
          </div>
        </a>
      `;
      listaPublicacoes.appendChild(div);
    });

    document.getElementById("contPublicacoes").textContent = publicacoes.length;
  }

  // ===============================
  // Inicializar
  // ===============================
  carregarFotoPerfil();
  carregarTreinosEPub();

</script>

</body>
</html>
